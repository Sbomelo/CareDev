@model IEnumerable<CareDev.Models.MedicationDispensation>


@{
    ViewData["Title"] = "Dispensed Medications";
    var patientId = ViewData["PatientId"];
}

<style>
    .section-header {
        font-size: 1.75rem;
        font-weight: 600;
        color: #0d6efd;
        margin-bottom: 25px;
    }

    .medication-card {
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-bottom: 20px;
    }

        .medication-card h5 {
            font-weight: 600;
            color: #0d6efd;
        }

    .medication-info {
        margin-bottom: 10px;
    }

    .status-success {
        color: #198754;
        font-weight: 500;
    }

    .status-danger {
        color: #dc3545;
        font-weight: 500;
    }

    .notes-small {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .action-button {
        margin-top: 15px;
    }

    .info-label {
        font-weight: 500;
        color: #555;
    }

    .info-value {
        color: #333;
    }

    .divider {
        border-top: 1px solid #dee2e6;
        margin: 15px 0;
    }
</style>

<div class="container mt-4">
    <div class="section-header">Dispensed Medications for <span class="text-dark">@ViewData["PatientName"]</span></div>

    @if (!Model.Any())
    {
        <div class="alert alert-info">No medication dispensation records found.</div>
    }
    else
    {
        @foreach (var item in Model)
        {
            <div class="medication-card">
                <h5>@item.MedicationName</h5>

                <div class="medication-info"><span class="info-label">Dosage:</span> <span class="info-value">@item.Dosage</span></div>
                <div class="medication-info"><span class="info-label">Route:</span> <span class="info-value">@item.Route</span></div>
                <div class="medication-info"><span class="info-label">Schedule:</span> <span class="info-value">@item.ScheduleLevel</span></div>
                <div class="medication-info"><span class="info-label">Dispensed By:</span> <span class="info-value">@item.Dispenser?.Name</span></div>
                <div class="medication-info"><span class="info-label">Time Dispensed:</span> <span class="info-value">@item.TimeDispensed.ToString("g")</span></div>

                <div class="divider"></div>

                @if (item.AdministerMeds != null)
                {
                    <div class="status-success">Status: Administered</div>
                    <div class="notes-small mt-1">
                        <strong>By:</strong> @item.AdministerMeds.AdministeredBy?.Name <br />
                        <strong>At:</strong> @item.AdministerMeds.TimeGiven.ToString("g") <br />
                        <strong>Notes:</strong> @item.AdministerMeds.Observations
                    </div>
                }
                else
                {
                    <div class="status-danger">Status: Not Administered</div>
                    <div class="action-button">
                        <a class="btn btn-outline-primary btn-sm"
                           asp-controller="MedicationAdministration"
                           asp-action="Create"
                           asp-route-dispenseId="@item.Id">
                            Administer
                        </a>
                    </div>
                }
            </div>
        }
    }
</div>
